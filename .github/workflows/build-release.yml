
name: Build Release

on:
    push:
        tags:
            - 'v*.*.*'
    workflow_dispatch:

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v2
            - name: Install Rust
              uses: actions-rs/toolchain@v1
              with:
                    toolchain: stable
                    profile: minimal
            - name: Install Netherfire
              env:
                    NF_REVISION: 'f3ce9858c05adef8e533b106359cddb6a7f6f355'
              run: cargo install --git https://github.com/octylFractal/netherfire.git --rev $NF_REVISION
            - name: Run Netherfire
              run: netherfire --create-modrinth-pack client --create-server-base server ./
            - name: Zip Server Files
              uses: vimtor/action-zip@v1.1
              with:
                    files: server/**/*
                    dest: server-ponydev-sfe-${{ github.ref_name }} 
            - name: Release
              uses: softprops/action-gh-release@v1
              with:
                    files: |
                        client/*.mrpack
                        server-ponydev-sfe-${{ github.ref_name }}.zip
                    tag_name: ${{ github.ref_name }}
                    body: ${{ github.ref_name }}
                    draft: false
                    prerelease: false
